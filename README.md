## Описание проекта

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта

Интернет-магазин для веб-разработчиков — Web-ларёк. В данном проекте можно просматривать каталог товаров, добавлять их в корзину и оформлять заказы, разработанный в парадигме MPV.

## Интерфейсы для отображения моделей данных, а так же данные и типы данных, используемые в приложении 

Интерфейс, представляющий состояние страницы:
counter: число, представляющее текущее состояние или количество элементов на странице.
catalog: массив элементов типа HTMLElement, содержащих каталог доступных товаров или объектов.
locked: логическое значение, указывающее, заблокирована ли страница для взаимодействия.

```
interface IPage {
	counter: number;
	catalog: HTMLElement[];
	locked: boolean;
}

```

Интерфейс, используемый для представления данных модального окна:
content: элемент типа HTMLElement, содержащий контент, отображаемый в модальном окне.

```
interface IModalData {
	content: HTMLElement;
}

```

Интерфейс, описывающий состояние формы:
valid: логическое значение, определяющее, является ли форма валидной.
errors: массив строк, содержащий сообщения об ошибках валидации формы.

```
interface IFormState {
	valid: boolean;
	errors: string[];
}

```

Интерфейс для API, описывающий методы получения данных с сервера

```
export interface IWebLarekAPI {
	getProductList: () => Promise<IProduct[]>;
	getProductItem: (id: string) => Promise<IProduct>;
	orderProducts: (order: IOrder) => Promise<IOrderResult>;
}

```

Интерфейс для обработки событий

```
export interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void;
    emit<T extends object>(event: string, data?: T): void;
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}

```

Описание продукта, содержащего поля, приходящие с сервера

```
export interface IProduct {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}

```

Описание корзины, содержащей список товаров и итоговую стоимость

```
export interface IBasket {
	items: string[];
	total: number;
}

```

Тип для валидации полей ввода

```
export type OrderForm = Omit<IOrder, 'total' | 'items'>;

```

Методы оплаты

```
export type PaymentMethod = 'cash' | 'card';

```

Описание заказа, содержащего поля для составления валидного заказа

```
export interface IOrder extends IContactsForm {
	payment: PaymentMethod;
	email: string;
	phone: string;
	address: string;
	items: string[];
	total: number;
}
```

Результат заказа, содержащий идентификатор созданного заказа и количество списанной валюты

```
export interface IOrderResult {
	id: string;
	total: number;
}
```

## Архитектура приложения

Код приложения организован по слоям в соответствии с парадигмой MVP:

### Базовый код

#### Класс Api

Содержит основную логику для отправки запросов. В конструкторе принимаются базовый адрес сервера и необязательный объект с заголовками. Его методы:

- <code>get</code>: выполняет GET-запрос к указанному эндпоинту и возвращает промис с объектом ответа от сервера.

- <code>post</code>: принимает объект с данными, которые будут отправлены в формате JSON в теле запроса, и передает их на заданный эндпоинт. По умолчанию используется POST-запрос, однако метод запроса можно изменить, задав третий параметр при вызове.

#### Абстрактный класс Component

Основной класс для всех элементов представления. Основные методы:

- <code>setText</code>: устанавливает текстовое содержимое.

- <code>setImage</code>: устанавливает изображение.

- <code>setVisible</code>: отображает элемент.

- <code>setDisable</code>: устанавливает статус блокировки.

- <code>setHidden</code>: скрывает элемент.

- <code>render</code>: возвращает элемент разметки для отображения на странице.

#### Класс EventEmitter

Брокер событий, который позволяет отправлять и подписываться на события, возникающие в системе. Класс применяется в презентере для обработки событий, а также в других слоях приложения для их генерации. Основные методы, реализованные классом, описаны в интерфейсе <code>IEvents</code>:

- <code>on</code>: подписка на событие.

- <code>emit</code>: инициация события.

- <code>trigger</code>: возвращает функцию, при вызове которой инициируется указанное событие.

Так же в EventEmitter реализованы следующие методы:

- <code>events</code> — переменная для кэширования событий.
- <code>on()</code> — функция для установки обработчика для определенного события.
- <code>off()</code> — функция для удаления обработчика с события.
- <code>emit()</code> — функция для инициирования события с переданными данными.
- <code>onAll</code> — функция для прослушивания всех событий.
- <code>offAll</code> — функция для удаления всех обработчиков.
- <code>trigger</code> — функция, создающая триггер для коллбэка, который генерирует событие при её вызове.

### Описание событий необходимых для работы приложения

- <code>modal:open</code> — при открытии модального окна блокирует основную страницу.

- <code>modal:close</code> — при закрытии модального окна разблокирует основную страницу.

- <code>card:select</code> — выбирает карточку товара, устанавливая её в режиме предпросмотра.

- <code>items:change</code> — обновляет каталог товаров при изменении списка продуктов, создавая новые карточки для отображения.

- <code>preview:change</code> — управляет добавлением и удалением товара из корзины на основе действий пользователя с карточкой товара.

- <code>basket:change</code> — обновляет счетчик товаров в корзине и отображает содержимое корзины.

- <code>basket:open</code> — открывает модальное окно с содержимым корзины.

- <code>order:open</code> — открывает модальное окно для оформления заказа.

- <code>order..*:change</code> — обрабатывает изменения в полях формы заказа, обновляя данные.

- <code>formErrorsOrder:change</code> — управляет состоянием формы и ошибками при оформлении заказа.

- <code>contacts..*:change</code> — обрабатывает изменения в полях формы контекста.

- <code>formErrorsContacts:change</code> — обновляет состояние и ошибки в форме контактов.

- <code>order:submit</code> — инициализирует процедуру подтверждения заказа, отображая форму для ввода контактной информации.

- <code>contacts:submit</code> — отправляет данные заказа и отображает сообщение об успехе. В случае ошибки логирует её в консоль.

### Слой данных

#### Класс View

В его конструкторе принимаются два параметра: <code>container</code> и <code>events</code>.

Класс является наследником <code>Component</code> и вводит поле events типа <code>IEvents</code>. <code>IEvents</code> в своё время предназначено для управления событиями компонента.

#### Класс WebLarekAPI

Содержит:

- <code>getProductList</code> — извлекает список всех доступных продуктов с сервера.

- <code>getProductItem</code> — получает подробную информацию о продукте по его идентификатору.

- <code>orderProducts</code> — отправляет информацию о заказе на сервер и возвращает результат операции.

#### Класс Component

Содержит методы:

- <code>setText</code> — задает текстовое содержимое элемента.

- <code>setDisabled</code> — включает или выключает блокировку элемента.

- <code>setImage</code> — задает изображение и альтернативный текст.

- <code>toggleClass</code> — переключает класс элемента.

- <code>render</code> — основной метод, возвращающий корневой DOM-элемент компонента.

### Слой отображения

#### Класс App Data

Класс, являющийся хранилищем всех данных приложения.

Содержит методы:

- <code>setItems(items: IProduct[])</code> — назначает список продуктов и инициирует событие изменения этого списка.
- <code>setPreview(item: IProduct)</code> — задает предпросмотр товара и вызывает событие изменения предпросмотра.
- <code>setPaymentMethod(method: PaymentMethod)</code> — задает способ оплаты для заказа.
- <code>setOrderField(field: keyof OrderForm, value: string)</code> — устанавливает значения полей заказа и проверяет их корректность.

- <code>addToBasket(item: IProduct)</code> — добавляет товар в корзину и вызывает событие изменения состояния корзины.
- <code>inBasket(item: IProduct)</code> — определяет, присутствует ли товар в корзине.

- <code>removeFromBasket(item: IProduct)</code> — исключает товар из корзины и инициирует событие изменения корзины.
- <code>clearBasket()</code> — очищает корзину и вызывает событие изменения состояния корзины.

- <code>validateOrder()</code> — проверяет корректность заказа и инициирует событие изменения ошибок в форме заказа.

#### Класс Page

Класс, отвечающий за отображение всего каталога товаров и главной страницы. Поля этого класса:

- <code>_counter: HTMLElement</code> — элемент, отображающий количество товаров в корзине.
- <code>_catalog: HTMLElement</code> — элемент для отображения каталога товаров.
- <code>_wrapper: HTMLElement</code> — элемент-обертка основного контента страницы.
- <code>_basket: HTMLElement</code> — элемент корзины на странице.

Содержит методы:

- <code>counter</code> - метод, устанавливающий значения счетчика.
- <code>catalog</code> - метод, устанавливающий содержиме каталога на странице.
- <code>locked</code> - метод, устанавливающий состояние блокировки прокрутки страницы.

#### Класс Card

Класс <code>Card</code>, наследующий от <code>Component<IProduct></code>, представляет собой карточку продукта с функциональностью для управления ее внутренними элементами, такими как заголовок, цена, категория, изображение, описание и кнопка:

Свойства класса:

Хранит ссылки на элементы карточки: <code>title</code>, <code>price</code>, <code>category</code>, <code>image</code>, <code>description</code>, и <code>button</code> и использует <code>Map</code> для определения цвета категории карточки, он обеспечивает управление визуальными элементами карточки и интерактивность с пользовательским интерфейсом.

Сеттеры и геттеры:

- <code>id</code>: Устанавливает и получает уникальный идентификатор карточки.
- <code>title</code>: Устанавливает и получает название продукта.
- <code>image</code>: Устанавливает изображение продукта.
- <code>price</code>: Устанавливает цену и активирует/деактивирует кнопку в зависимости от наличия цены.
- <code>category</code>: Устанавливает категорию и применяет соответствующий класс для цветового оформления.
- <code>description</code>: Устанавливает описание продукта.
- <code>button</code>: Устанавливает текст на кнопке.

#### Класс Modal

Класс для работы с модальными окнами.

Поля класса:

- <code>_closeButton: HTMLButtonElement</code> — кнопка для закрытия модального окна.
- <code>_content: HTMLElement</code> — контент модального окна, представляющий всё его содержимое.

Содержит методы:

- <code>content</code> — метод, задающий новое содержимое модального окна, заменяя старое.
- <code>open</code> — метод, открывающий модальное окно.
- <code>close</code> — метод, закрывающий модальное окно.

#### Класс Basket

Класс для отображения корзины содержит следующие поля и методы:

- <code>template</code> — статическое поле, содержащее HTML-шаблон корзины.

- <code>_list</code> — приватное поле для хранения ссылки на элемент корзины.
- <code>_total</code> — приватное поле для хранения ссылки на элемент, отображающий общую сумму.
- <code>_button</code> — приватное поле для хранения ссылки на элемент кнопки оформления заказа.

- <code>selected</code> — метод для установки выбранных товаров. Если есть выбранные товары, кнопка оформления заказа активируется, в противном случае — деактивируется.
- <code>items</code> — метод для установки списка товаров в корзине. Если список не пуст, он заменяет элементы внутри контейнера корзины. В случае пустого списка отображается сообщение, что "Корзина пуста", и обновляется состояние кнопки оформления заказа.
- <code>total</code> — метод для установки общей суммы товаров в корзине.

#### Класс Order

Класс <code>Order</code>, наследующий от <code>Form<OrderForm></code>, представляет собой форму для обработки заказа с возможностью выбора метода оплаты, обеспечивающий управление процессом оформления заказа, включая выбор метода оплаты и ввод адреса доставки. Принимает контейнер формы <code>(HTMLFormElement)</code> и объект для обработки событий <code>(EventEmitter)</code>.
Инициализирует <code>_paymentCard</code> и <code>_paymentCash</code>, используя вспомогательную функцию <code>ensureElement</code>.

Содержит свойства:

- <code>_paymentCard</code>: кнопка для выбора оплаты картой <code>(тип HTMLButtonElement)</code>.
- <code>_paymentCash</code>: кнопка для выбора оплаты наличными <code>(тип HTMLButtonElement)</code>.

Содержит сеттеры:

- <code>address</code>: устанавливает значение поля ввода адреса, извлекая элемент 'address' из коллекции элементов формы.
- <code>payment</code>: управляет активным состоянием кнопок оплаты, добавляя или удаляя класс 'button_alt-active' в зависимости от выбранного способа оплаты.

#### Класс clientContacts

Класс <code>clientContacts</code>, наследующий от <code>Form<OrderForm></code>, представляет собой форму для ввода контактной информации клиента и содержит конструктор, который принимает элемент формы <code>(HTMLFormElement)</code> и объект для обработки событий <code>(EventEmitter)</code>, вызывает конструктор супер-класса <code>Form</code>, передавая ему эти параметры.

Содержит сеттеры:

- <code>email</code>: Устанавливает значение поля ввода электронной почты, извлекая элемент по имени 'email' из коллекции элементов формы.
- <code>phone</code>: Устанавливает значение поля ввода телефона, извлекая элемент по имени 'phone' из коллекции элементов формы.

Класс обеспечивает специфику работы с контактной информацией клиента, позволяя легко устанавливать значения полей формы.

#### Класс Form

- <code>Form</code> наследует класс <code>View<IFormState></code>, представляет собой базовую форму для сбора и обработки данных, его конструктор инициализирует <code>_submit</code> и <code>_errors</code>, используя вспомогательную функцию <code>ensureElement</code>, он обеспечивает интеграцию с системой событий и управление состоянием формы, позволяя легко обрабатывать ввод и валидацию данных.

Содержит свойства:

- <code>_submit</code>: кнопка отправки формы, тип элемента HTMLButtonElement.
- <code>_errors</code>: контейнер для отображения ошибок валидации, тип элемента HTMLElement.
- <code>container</code>: элемент формы (HTMLFormElement).
- <code>events</code>: объект для обработки событий (EventEmitter).

А так же содержит следующие методы:

- <code>onInputChange(field: keyof T, value: string)</code>: вызывает событие изменения для конкретного поля формы, передавая имя поля и его значение.
- <code>set valid(value: boolean)</code>: устанавливает состояние кнопки отправки формы (активна/неактивна) в зависимости от значения valid.
- <code>set errors(value: string)</code>: выводит текст ошибок в соответствующий контейнер.
- <code>render(state: Partial & IFormState)</code>: обновляет состояние формы, устанавливая значения входных полей и отображая состояние формы, включая ошибки.

#### Класс Success

Класс <code>Success</code> наследует <code>Component<IOrderResult></code>, представляет собой компонент для отображения результатов успешного заказа, он обеспечивает интерактивное отображение успешного завершения заказа, позволяя пользователю видеть сумму и закрывать уведомление. Класс принимает контейнер для компонента <code>(HTMLFormElement)</code> и опциональные действия <code>(ISuccessActions)</code>.
Инициализирует <code>_total</code> и <code>_close</code> с помощью вспомогательной функции <code>ensureElement</code>.
Если предоставлено действие <code>onClick</code>, добавляет обработчик клика на кнопку закрытия либо на контейнер, если кнопка отсутствует.

Содержит свойства:
- <code>_total</code>: элемент, который отображает общую сумму заказа <code>(тип HTMLElement)</code>.
- <code>_close</code>: кнопка для закрытия сообщения об успехе <code>(тип HTMLButtonElement)</code>.

А так же сеттер:
- <code>total</code>: устанавливает текст элемента <code>_total</code>, форматируя его для отображения общей суммы, списанной с пользователя.

